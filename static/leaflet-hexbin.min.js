/*! leaflet-hexbin.js Version: 0.1.3 */
!function(){"use strict";L.HexbinLayer=L.Class.extend({includes:[L.Mixin.Events],options:{radius:10,opacity:.5,lng:function(t){return t[0]},lat:function(t){return t[1]},value:function(t){return t.length},valueFloor:0,valueCeil:void 0,colorRange:["#f7fbff","#08306b"],radiusRange:[1,10]},initialize:function(t){L.setOptions(this,t),this._hexLayout=d3.hexbin().radius(this.options.radius).x(function(t){return t.point[0]}).y(function(t){return t.point[1]}),this._data=[],this._colorScale=d3.scale.linear().range(this.options.colorRange).clamp(!0),this._radiusScale=d3.scale.sqrt().range(this.options.radiusRange).clamp(!0)},onAdd:function(t){this._map=t,this._container=this._initContainer(),t.on({moveend:this._redraw},this),this._redraw()},onRemove:function(t){this._destroyContainer(),t.off({moveend:this._redraw},this),this._container=null,this._map=null,this._data=null},addTo:function(t){return t.addLayer(this),this},_initContainer:function(){var t=null;if(null==this._container){var n=this._map.getPanes().overlayPane;t=d3.select(n).append("svg").attr("class","leaflet-layer leaflet-zoom-hide")}return t},_destroyContainer:function(){null!=this._container&&this._container.remove()},_redraw:function(){var t=this;if(t._map){var n=t._data.map(function(n){var i=t.options.lng(n),o=t.options.lat(n),e=t._project([i,o]);return{o:n,point:e,d:n}}),i=this._map.getZoom(),o=2*this.options.radius,e=this._getBounds(n),a=e.max[0]-e.min[0]+2*o,r=e.max[1]-e.min[1]+2*o,s=e.min[1]-o,u=e.min[0]-o;this._hexLayout.size([a,r]),this._container.attr("width",a).attr("height",r).style("margin-left",u+"px").style("margin-top",s+"px");var h=this._container.selectAll("g.hexbin").data([i],function(t){return t});h.enter().append("g").attr("class",function(t){return"hexbin zoom-"+t}),h.attr("transform","translate("+-u+","+-s+")"),h.exit().remove(),this._createHexagons(h,n)}},_createHexagons:function(t,n){var i=this,o=i._hexLayout(n),e=d3.extent(o,function(t){return i.options.value(t)});null==e[0]&&(e[0]=0),null==e[1]&&(e[1]=0),null!=i.options.valueFloor&&(e[0]=i.options.valueFloor),null!=i.options.valueCeil&&(e[1]=i.options.valueCeil),i._colorScale.domain(e),i._radiusScale.domain(e),i.hexagons=t.selectAll("path.hexbin-hexagon").data(o,function(t){return t.i+":"+t.j}),i.hexagons.transition().duration(200).attr("fill",function(t){return i._colorScale(t.length)}),i.hexagons.enter().append("path").attr("class","hexbin-hexagon").attr("d",function(t){return"M"+t.x+","+t.y+i._hexLayout.hexagon(i._radiusScale(t.length))}).attr("fill",function(t){return i._colorScale(t.length)}).attr("opacity",.01).transition().duration(200).attr("opacity",i.options.opacity),i.options.hexMouseOver&&i.hexagons.on("mouseover",i.options.hexMouseOver),i.options.hexMouseOut&&i.hexagons.on("mouseout",i.options.hexMouseOut),i.options.hexClick&&i.hexagons.on("click",i.options.hexClick),i.hexagons.exit().transition().duration(200).attr("opacity",.01).remove()},_project:function(t){var n=this._map.latLngToLayerPoint([t[1],t[0]]);return[n.x,n.y]},_getBounds:function(t){if(null==t||t.length<1)return{min:[0,0],max:[0,0]};var n=[[999,999],[-999,-999]];return t.forEach(function(t){var i=t.point[0],o=t.point[1];n[0][0]=Math.min(n[0][0],i),n[0][1]=Math.min(n[0][1],o),n[1][0]=Math.max(n[1][0],i),n[1][1]=Math.max(n[1][1],o)}),{min:n[0],max:n[1]}},getBounds:function(){var t=this,n=t._data.map(function(n){var i=t.options.lng(n),o=t.options.lat(n);return{o:n,point:[i,o]}}),i=t._getBounds(n);return[[i.min[0],i.min[1]],[i.max[0],i.max[1]]]},data:function(t){return this._data=null!=t?t:[],this._redraw(),this},colorScale:function(t){return void 0===t?this._colorScale:(this._colorScale=t,this._redraw(),this)},radiusScale:function(t){return void 0===t?this._radiusScale:(this._radiusScale=t,this._redraw(),this)},value:function(t){return void 0===t?this.options.value:(this.options.value=t,this._redraw(),this)},hexClick:function(t){return void 0===t?this.options.hexClick:(this.options.hexClick=t,this.hexagons.on("click",t),this)},hexMouseOver:function(t){return void 0===t?this.options.hexMouseOver:(this.options.hexMouseOver=t,this.hexagons.on("mouseover",t),this)},hexMouseOut:function(t){return void 0===t?this.options.hexMouseOut:(this.options.hexMouseOut=t,this.hexagons.on("mouseout",t),this)},setZIndex:function(t){this._container&&this._container[0]&&this._container[0][0]&&(this._container[0][0].style.zIndex=t)}}),L.hexbinLayer=function(t){return new L.HexbinLayer(t)}}();